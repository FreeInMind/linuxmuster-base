Linux Musterlösung 3.0, Schutz der öffentlichen Webverzeichnisse unter /var/www.
--------------------------------------------------------------------------------

Pfade:
Schülerseiten unter /var/www/people/students/$KLASSE
Lehrerseiten unter /var/www/people/teachers
Klassenseiten unter /var/www/people/classes
Projektseiten unter /var/www/people/projects

Die Verzeichnisse
/var/www/people/students/$KLASSE
/var/www/people/teachers
/var/www/people/classes
/var/www/people/projects
gehören root:root,
alles darunter www-data:www-data, damit per webdavs in die Webordner
geschrieben werden kann.
Permissions octal für die .htaccess files sind 0400.

Tags für die Schulkonsole:
# public/private - Webordner ist öffentlich/nicht öffentlich
# upload/noupload - Schüler dürfen hochladen/nicht hochladen

Folgende Fälle werden abgedeckt, das entsprechende .htaccess template ist
jeweils dabei:

1. Schülerverzeichnis frei, mit WebDAV für Schüler
    o Welt darf anschauen
    o Schüler, Administrator und Gruppe teachers dürfen hochladen

-- begin .htaccess --
# public - www access world wide allowed
# upload - DAV allowed for student, Administrator and teachers
AuthType Basic
AuthName "@@username@@"
<LimitExcept GET OPTIONS>
  Require user @@username@@ Administrator
  Require group teachers
</LimitExcept>
-- end .htaccess --

Test:
https://server.ml30.mine.nu/people/students/5a/hartmape/
webdavs://server.ml30.mine.nu/people/students/5a/hartmape/


2. Schülerverzeichnis frei, ohne WebDAV für Schüler
    o Welt darf anschauen
    o nur Gruppe Lehrer und Administrator dürfen hochladen

-- begin .htaccess --
# public - www access world wide allowed
# noupload - DAV only allowed for Administrator and teachers
AuthType Basic
AuthName "@@username@@"
<LimitExcept GET OPTIONS>
  Require user Administrator
  Require group teachers
</LimitExcept>
-- end .htaccess --

Test:
https://server.ml30.mine.nu/people/students/13a/gengleac/
webdavs://server.ml30.mine.nu/people/students/13a/gengleac/


3. Schülerverzeichnis gesperrt, mit WebDAV für Schüler
    o Welt darf nicht anschauen
    o Schüler, Gruppe Lehrer und Administrator dürfen per https anschauen und hochladen

-- begin .htaccess --
# private - www access world wide denied
# upload - DAV and https allowed for student, Administrator and teachers
AuthType Basic
AuthName "@@username@@"
SSLRequireSSL
Require user @@username@@ Administrator
Require group teachers
-- end .htaccess --

Test:
https://server.ml30.mine.nu/people/students/10a/kruegeri
webdavs://server.ml30.mine.nu/people/students/10a/kruegeri


4. Schülerverzeichnis gesperrt, ohne WebDAV für Schüler
    o Welt darf nicht anschauen
    o nur Gruppe Lehrer und Administrator dürfen per https anschauen und hochladen

-- begin .htaccess --
# private - www access world wide denied
# noupload - DAV and https allowed only for Administrator and teachers
AuthType Basic
AuthName "@@username@@"
SSLRequireSSL
Require user Administrator
Require group teachers
-- end .htaccess --

Test:
https://server.ml30.mine.nu/people/students/10a/frayka
webdavs://server.ml30.mine.nu/people/students/10a/frayka


5. Lehrerverzeichnis frei
    o Welt darf anschauen
    o Lehrer darf hochladen

-- begin .htaccess --
# public - www access world wide allowed
# DAV allowed for teacher
AuthType Basic
AuthName "@@username@@"
<LimitExcept GET OPTIONS>
  Require user @@username@@
</LimitExcept>
-- end .htaccess --

Test:
https://server.ml30.mine.nu/people/teachers/schoen
webdavs://server.ml30.mine.nu/people/teachers/schoen


6. Lehrerverzeichnis gesperrt
    o Welt darf nicht anschauen
    o Lehrer darf per https anschauen und hochladen

-- begin .htaccess --
# private - www access world wide denied
# DAV and https allowed for teacher
AuthType Basic
AuthName "@@username@@"
SSLRequireSSL
Require user @@username@@
-- end .htaccess --

Test:
https://server.ml30.mine.nu/people/teachers/zell
webdavs://server.ml30.mine.nu/people/teachers/zell


7. Klassen-/Projektverzeichnis frei, mit WebDAV für Schüler
    o Welt darf anschauen
    o Klassen-/Projektmitglieder und Administrator dürfen hochladen

-- begin .htaccess --
# public - www access world wide allowed
# upload - DAV allowed for group members and Administrator
AuthType Basic
AuthName "@@groupname@@"
<LimitExcept GET OPTIONS>
  Require user Administrator
  Require group @@groupname@@
</LimitExcept>
-- end .htaccess --

Test:
https://server.ml30.mine.nu/people/classes/13a
webdavs://server.ml30.mine.nu/people/classes/13a
Lehrer: zell


8. Klassen-/Projektverzeichnis frei, ohne WebDAV für Schüler
    o Welt darf anschauen
    o nur Lehrer und Administrator dürfen hochladen

-- begin .htaccess --
# public - www access world wide allowed
# noupload - DAV allowed for teachers and Administrator
AuthType Basic
AuthName "@@groupname@@"
<LimitExcept GET OPTIONS>
  Require user Administrator
  Require group teachers
</LimitExcept>
-- end .htaccess --

Test:
https://server.ml30.mine.nu/people/classes/10a
webdavs://server.ml30.mine.nu/people/classes/10a
Lehrer: schoen


9. Klassen-/Projektverzeichnis gesperrt, mit WebDAV für Klassen-/Projektmitglieder
    o Welt darf nicht anschauen
    o Klassen-/Projektmitglieder und Administrator dürfen per https anschauen und hochladen

-- begin .htaccess --
# private - www access world wide denied
# upload - DAV and https allowed for group members and Administrator
AuthType Basic
AuthName "@@groupname@@"
SSLRequireSSL
Require user Administrator
Require group @@groupname@@
-- end .htaccess --

Test:
https://server.ml30.mine.nu/people/projects/projekt_test
webdavs://server.ml30.mine.nu/people/projects/projekt_test
Projektmitglieder: gelhaata, ilkesju, schirrmo, zem (Lehrer)


10. Klassen-/Projektverzeichnis gesperrt, ohne WebDAV für Schüler
     o Welt darf nicht anschauen
     o nur Lehrer und Administrator dürfen per https anschauen und hochladen

-- begin .htaccess --
# private - www access world wide denied
# noupload - DAV and https allowed for group teachers and Administrator
AuthType Basic
AuthName "@@groupname@@"
SSLRequireSSL
Require user Administrator
Require group teachers
-- end .htaccess --

Test:
https://server.ml30.mine.nu/people/classes/5a
webdavs://server.ml30.mine.nu/people/classes/5a
Lehrer: bo


Ich denke mit diesen 10 Möglichkeiten haben wir alle Anwendungsfälle abgedeckt.

Default templates beim Anlegen von
 o Schülern         -> 4.
 o Lehrern          -> 6.
 o Klassen/Projekte -> 10.

Alternativ wäre noch möglich, dass man bei 8. & 10. statt global der Gruppe teachers nur den Lehrern der Klasse bzw. des Projekts Zugriff gestattet. Dann fällt die Zeile "Require group teachers" weg und nach "Require user Administrator" müsste man alle Lehrer auflisten (nur mit Leerzeichen getrennt).
Allerdings musst diese Datei dann jedes Mal angepasst werden, wenn ein Lehrer in eine Klasse bzw. Projekt ein- oder austritt.

Grundsätzlich werden Aktionen, die Authentifizierung erfordern nur über SSL abgewickelt.
DAV immer über webdavs, bei 3., 4., 6. 9. und 10. auch noch https.


WebDAV-Client einrichten
------------------------

1. Linux

   WebDAV-Zugriff funktioniert unter Linux ohne Probleme mit Konqueror direkt
   über die webdavs-Url (s.o.).

2. Windows XP (SP 2)

   Webordner einrichten:
   o Netzwerkumgebung öffnen
   o "Netzwerkressource hinzufügen" anklicken
   o Assistent öffnet sich, 2x "Weiter" klicken
   o Adresse eingeben, z.Bsp.: https://server/people/zell, dann "Weiter" klicken
   o Zertifikat bestätigen, ggf. 2x
   o Benutzername und Kennwort eingeben
   o ggf. den Namen der Netzwerkressource anpassen
   o "Fertig stellen" klicken
   o Serverzertifikat nochmals bestätigen, ggf. 2x
   o und nochmal Benutzernamen und Kennwort eingeben
   o Explorerfenster öffnet sich
   o auf Laufwerk H: einen Ordner "Webordner" erstellen
   o die neu erstellte Netzwerkressource aus der Netzwerkumgebung in den "Webordner"
     verschieben, so ist sicher gestellt, dass er bei nächsten Synchronisation der
     Arbeitsstation nicht verschwunden ist.

   Eine weitere Möglichkeit bietet das freie Novell Netdrive.
   Damit lassen sich die WebDAV-Freigaben einfach auf ein Laufwerk mappen.
   Zu beachten ist dabei, dass als Ziel-URL nicht webdavs:// sondern https:// eingegeben werden muss.
   Das Programm selbst kann hier heruntergeladen werden:
   http://www.ncs.ncsu.edu/ncs/data/netdrive/netdrive.exe
   Nachteil: Es speichert seine Einstellungen in der Registry ab. Nach der Synchronisation der
   Arbeitsstation sind die einstellungen somit verloren.


10.05.2006
Thomas Schmitt
<schmitt@lmz-bw-de>
